---
title: "EDA XI Multiple Correspondance Analysis"
subtitle: "Statistiques Master I, MFA et MIDS"
author: "Stéphane Boucheron"
institute: "Université de Paris"
date: "2020/12/11 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    css: ["header-footer.css", "xaringan-themer.css"]
    lib_dir: libs
    seal: false
    includes:
      in_header:
        - 'toc.html'
    nature:
      nature:
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
name: inter-slide
class: left, middle, inverse

{{ content }}

---
name: layout-general
layout: true
class: left, middle

```{r setup, child="loaders_fixers.Rmd", echo=FALSE, message=FALSE, warning=FALSE}

```


```{r, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
pacman::p_load("ggdendro")
pacman::p_load("fastcluster")
pacman::p_load("mixdist")
pacman::p_load("factoextra")
data("iris")
data("pearson")
```


```{r, load_refs, echo=FALSE, cache=FALSE, warning=FALSE, message=FALSE}
require(RefManageR, quietly = TRUE)
BibOptions(check.entries = FALSE,
           bib.style = "authoryear",
           cite.style = 'authoryear',
           style = "markdown",
           hyperlink = FALSE,
           dashed = FALSE)
myBib <- ReadBib("./mon_chapeau.bib", check = FALSE, )
```




```{r, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE}
NoCite(myBib, "MR3851754")
NoCite(myBib, "MR3080408")
NoCite(myBib, "MR3316191")
NoCite(myBib, "MR3316191")
NoCite(myBib, "zbMATH06322139")
NoCite(myBib, "Har75")
NoCite(myBib, "MR2677125")
NoCite(myBib, "HaTiFr01")
NoCite(myBib, "Mur12")
NoCite(myBib, "moitra2018algorithmic")
```

---
class: middle, left, inverse



# Exploratory Data Analysis XI Multiple Correspondance Analysis

### `r Sys.Date()`


#### [EDA Master I MIDS et MFA](http://stephane-v-boucheron.fr/courses/eda)

#### [Stéphane Boucheron](http://stephane-v-boucheron.fr)

---
class: middle, inverse

## `r fontawesome::fa("map", fill="white")`

### [Motivation](#bigpic)

### [MCA](#mca)

### [CCA](#cca)


???


---
name: bigpic
template: interslide

# Motivation


```{r, warning=FALSE, echo=FALSE, message=FALSE}
require(tidyverse)
require(FactoMineR)
require(factoextra)
require(FactoInvestigate)
```

---

The aim of multiple correspondence analysis (MCA) is to summarise and visualise
a data table where individuals are described by _qualitative_ variables.

MCA is used to study the similarities between individuals from the point of
view of all the variables and identify individuals' profiles

MCA is also used to assess relationships between variables and study the associations between categories 

As with PCA and CA, the individuals or groups of individuals
(rows) can be connected with categories of  variables (columns)

.fr[From _R for statistics_, Cornillon et al. Chapman & Hall. Pub.]


---

### FactoMineR

<iframe src="http://factominer.free.fr/factomethods/multiple-correspondence-analysis.html"  width="750px" height="400px"></iframe>

---

### Handling more than 2 qualitative variables

```{r}

```


---

### Indicator matrix



---
name: visualizations


### Visualization     


---

### `credit` dataset

- A survey

- Demographic variables

- Attitudinal variables

---

### `MCA` from the `FactoMineR` package.

.fl.w-40.pa2[
```{r, message=FALSE}
fpath <- "./DATA/credit.csv"

credit <- read_csv2(fpath) %>%
  mutate(across(where(is.character), 
                factor)
         )

credit$Age <- credit$Age %>%
  as_factor() %>%
  fct_inseq()  
```
]

.fl.w-60.pa2.f6[

```{r, echo=FALSE}
credit %>% glimpse(width = 40)
```


]

- Columns 1 to 5 `Marche`, ..., `Endettement` are concerned with _attitudes_
- Column 6 to 11 are concerned with _demographics_


---
exclude: true 

### Handling rare categories 



---
exclude: true 

### Spotting rare categories.

```{r, eval=FALSE, echo=FALSE}
rare_categories <- credit %>%
  map(table) %>%
  map(~ which(. <= 10)) 

 rare_categories <- rare_categories[which(rare_categories %>% 
                        map(length) >0)] 
```

---

### Handling rare categories for `Marche`, `Enfants`, `Logement`

.panelset[

.panel[ .panel-name[`Marche`]
```{r, echo=TRUE}

credit$Marche <- fct_collapse(credit$Marche,
  "Mobilier / Ameublement" = "Mobilier / Ameublement",
  "Renovation" = "Renovation",
  "Moto" = c ("Moto", "Scooter", "Side-car"),
  "Voiture" = "Voiture")  
```
]

.panel[ .panel-name[`Enfants`]
```{r}
credit$Enfants <- credit$Enfants %>%
  fct_lump(n = 3, other_level = "Enf>2") 
```
]

.panel[ .panel-name[`Logement`]

```{r}
credit$Logement <- credit$Logement %>%
  fct_collapse(
    "Accedant a la propriete"="Accedant a la propriete",
    "Locataire"="Locataire",
    "Loge par ..." = c("Loge par l'employeur", 
                       "Loge par la famille"),
    "Proprietaire"="Proprietaire") 
```
]

]

---

### MCA over attitude variables 

```{r}
res.mca <- credit %>%
  FactoMineR::MCA(graph = FALSE, 
                  quali.sup = 6:11) 
```

---

### Screeplot

.fl.w-60.pa2[

```{r, echo=FALSE}
qplot(x=as_factor(seq_along(res.mca$eig[, 2])), y=res.mca$eig[, 2]) +
  geom_col() +
  ylab("Eigenvalues") +
  xlab("") +
  ggtitle("MCA screeplot", "credit data, attitudinal variables")
```

The first two dimensions express $\approx 30\%$ of the total variance,
which is relatively high in MCA  `r fontawesome::fa("smile")`

]

.fl.w-40.pa2.f6[

```{r, results='markup', eval=FALSE, echo=FALSE}
res.mca$eig%>%
  knitr::kable(format="markdown", digits = 2)
```

|Dim.   | Eigenvalue| `%` of inertia | cumul. `%` of inertia|
|:-----:|----------:|---------------:|---------------------:|
| 1  |       0.39|           16.26|                  16.26|
| 2  |       0.32|           13.37|                  29.63|
| 3  |       0.29|           12.15|                  41.79|
| 4  |       0.27|           11.33|                  53.12|
| 5  |       0.23|            9.38|                  62.50|
| 6  |       0.18|            7.68|                  70.19|
| 7  |       0.17|            7.09|                  77.27|
| 8  |       0.16|            6.73|                  84.00|
| $\vdots$ | $\vdots$ | $\vdots$ | $\vdots$ |

]


---

### Graphics

Object `res.mca` belongs to class `MCA` 

Class `MCA`  has its own `plot` method

The MCA function yields a graph simultaneously representing individuals and
categories (active and illustrative) on the first two dimensions. 

This representation quickly becomes messy.

---

### Plotting individuals 

Making variables whether active or not, _invisible_

```{r}
plot(res.mca, invisible=c("var","quali.sup"))
```

---

### Clustering individuals

We can use
the colour aesthetic to check whether some pattern emerges.

```{r}
plot(res.mca, invisible=c("var","quali.sup"), habillage="Marche")
```

Does it?

---

### Colouring according to profession 

```{r}
plot(res.mca, invisible=c("var","quali.sup"), habillage="Profession")
```


---

### Colouring according to Age 

```{r}
plot(res.mca, invisible=c("var","quali.sup"), habillage="Age")
```


---

### Colouring according to Impaye 

```{r}
plot(res.mca, invisible=c("var","quali.sup"), habillage="Impaye")
```

---

> Dimension 2 mainly opposes people in great financial difficulty (below) with
the others (above). We can therefore identify people who have difficulty paying
back their loan (three or more payments missed) and those who have taken
out TPD insurance. This dimension can thus be qualified as the dimension of financial difficulty.


---

### Plotting variables

```{r}
plot(res.mca, choix="var", invisible = "quali.sup")
```

---


```{r}
plot(res.mca, choix="var")
```

---

```{r}
plot(res.mca, invisible=c("ind", "quali.sup"))
```

---

### AUtomatic report 

```{r, eval=FALSE}
FactoInvestigate::Investigate(res.mca, keepRmd = TRUE)
```

---

### Dimension description

Automatically describing the dimensions of variability.

This function also sorts the qualitative
variables as well as the categories of the qualitative variables. In order to do
so, a one-way analysis of variance model is constructed for
each qualitative variable: variable Y corresponds to the principal component
(the coordinates of the individuals or scores) and is explained according to a
qualitative variable.

---

The _p-value_ of the overall test (F-test) is calculated as
well as the p-values of the tests of each category.  The p-values
associated with the F-tests are sorted in ascending order. Thus, the qualitative
variables are sorted from most to least characteristic. In the same way,
the p-values of the t-tests by categories are sorted (in ascending order when
the coefficient is positive, and in descending order when it is negative). This
will identify the most characteristic categories.

---

```{r}
FactoMineR::dimdesc(res.mca)
```


---

## Bibliographical remarks


---
class: middle, center, inverse

background-image: url('./img/pexels-cottonbro-3171837.jpg')
background-size: cover


# The End
